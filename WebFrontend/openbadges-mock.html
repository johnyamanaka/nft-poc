<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenBadges 3.0 ãƒã‚¤ã‚¯ãƒ­ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç™ºè¡Œã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
    <style>
        /* Mode Switcher */
        .mode-switcher {
            display: flex;
            justify-content: center;
            gap: 0;
            margin: 20px 0;
            background: #f0f0f0;
            border-radius: 50px;
            padding: 5px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            color: #666;
            border-radius: 50px;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .mode-btn:hover:not(.active) {
            background: #e0e0e0;
        }

        /* Badge Display */
        .badge-display {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin: 20px 0;
        }

        .badge-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            max-width: 400px;
            margin: 0 auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .badge-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .badge-icon {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .badge-title {
            flex: 1;
        }

        .badge-title h4 {
            margin: 0 0 5px 0;
            font-size: 1.3rem;
        }

        .badge-title p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .badge-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }

        .badge-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .badge-detail-item:last-child {
            border-bottom: none;
        }

        .badge-detail-label {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .badge-detail-value {
            font-weight: 600;
        }

        /* JSON Display */
        .json-display {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .json-display pre {
            color: #d4d4d4;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .json-display .json-key {
            color: #9cdcfe;
        }

        .json-display .json-string {
            color: #ce9178;
        }

        .json-display .json-number {
            color: #b5cea8;
        }

        /* Action Buttons */
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn-secondary {
            flex: 1;
            min-width: 150px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* Verification Result */
        .verification-result {
            margin-top: 20px;
            padding: 25px;
            border-radius: 15px;
        }

        .verification-result.success {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .verification-result.failed {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .verification-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 15px;
        }

        .verification-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .verification-result.success .verification-title {
            color: #155724;
        }

        .verification-result.failed .verification-title {
            color: #721c24;
        }

        /* File Upload Area */
        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
        }

        .file-upload-area:hover {
            background: #eef1ff;
            border-color: #764ba2;
        }

        .file-upload-area.dragover {
            background: #e3e8ff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
        }

        .upload-text strong {
            color: #667eea;
        }

        /* Tabs */
        .tab-container {
            margin: 20px 0;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        /* OpenBadges Logo */
        .ob-logo {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Comparison Table */
        .comparison-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .comparison-note h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .comparison-note p {
            color: #856404;
            margin: 0;
        }

        /* Mode indicator in header */
        .mode-indicator {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ ãƒã‚¤ã‚¯ãƒ­ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç™ºè¡Œãƒ»æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="subtitle">OpenBadges 3.0 + Verifiable Credentials</p>
            <div class="mode-indicator">
                <span class="ob-logo">ğŸ… OpenBadges 3.0</span>
            </div>
        </header>

        <!-- Mode Switcher -->
        <div style="padding: 20px 40px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0;">
            <div class="mode-switcher">
                <button class="mode-btn" onclick="switchMode('msvc')">
                    ğŸ” Microsoft VC
                </button>
                <button class="mode-btn active" onclick="switchMode('openbadges')">
                    ğŸ… OpenBadges 3.0
                </button>
            </div>
            <p style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 10px;">
                â€» ç™ºè¡Œæ–¹å¼ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™
            </p>
        </div>

        <!-- Role Selection -->
        <div class="role-selector" id="role-selector">
            <h2>ã‚ãªãŸã®å½¹å‰²ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            <div class="role-cards">
                <div class="role-card" onclick="selectRole('university')">
                    <div class="role-icon">ğŸ›ï¸</div>
                    <h3>å¤§å­¦</h3>
                    <p>ãƒãƒƒã‚¸ã‚’ç™ºè¡Œ</p>
                </div>
                <div class="role-card" onclick="selectRole('student')">
                    <div class="role-icon">ğŸ‘¨â€ğŸ“</div>
                    <h3>å­¦ç”Ÿ</h3>
                    <p>ãƒãƒƒã‚¸ã‚’å—ã‘å–ã‚‹ãƒ»ç®¡ç†</p>
                </div>
                <div class="role-card" onclick="selectRole('company')">
                    <div class="role-icon">ğŸ¢</div>
                    <h3>ä¼æ¥­</h3>
                    <p>ãƒãƒƒã‚¸ã‚’æ¤œè¨¼</p>
                </div>
            </div>
        </div>

        <!-- University View (OpenBadges Mode) -->
        <div class="role-view" id="university-view" style="display: none;">
            <div class="role-header">
                <div class="role-badge">ğŸ›ï¸ å¤§å­¦ç®¡ç†è€… <span class="ob-logo" style="margin-left: 10px;">ğŸ… OpenBadges</span></div>
                <button class="btn-back" onclick="resetRole()">â† å½¹å‰²é¸æŠã«æˆ»ã‚‹</button>
            </div>

            <div class="comparison-note">
                <h4>ğŸ”„ OpenBadges 3.0 ãƒ¢ãƒ¼ãƒ‰</h4>
                <p>Microsoft Authenticatorã®ä»£ã‚ã‚Šã«ã€æ¨™æº–çš„ãªOpenBadges 3.0å½¢å¼ã§ãƒãƒƒã‚¸ã‚’ç™ºè¡Œã—ã¾ã™ã€‚ãƒãƒƒã‚¸ã¯JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã€æ§˜ã€…ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å…±æœ‰ãƒ»æ¤œè¨¼ã§ãã¾ã™ã€‚</p>
            </div>

            <div class="info-box university-info">
                <h3>ğŸ“‹ OpenBadges 3.0ã§ã®ç™ºè¡Œ</h3>
                <p>OpenBadges 3.0ã¯ã€W3C Verifiable Credentialsæ¨™æº–ã«æº–æ‹ ã—ãŸãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒƒã‚¸å½¢å¼ã§ã™ã€‚</p>
                <ul>
                    <li>âœ… å›½éš›æ¨™æº–ï¼ˆ1EdTech / W3Cï¼‰ã«æº–æ‹ </li>
                    <li>âœ… LinkedInãªã©å¤šæ•°ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å…±æœ‰å¯èƒ½</li>
                    <li>âœ… æš—å·ç½²åã«ã‚ˆã‚Šæ”¹ã–ã‚“é˜²æ­¢</li>
                    <li>âœ… JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å…±æœ‰</li>
                </ul>
            </div>

            <div class="flow-steps-horizontal">
                <div class="step active">
                    <div class="step-num">1</div>
                    <p>æƒ…å ±å…¥åŠ›</p>
                </div>
                <div class="arrow">â†’</div>
                <div class="step">
                    <div class="step-num">2</div>
                    <p>ãƒãƒƒã‚¸ç™ºè¡Œ</p>
                </div>
                <div class="arrow">â†’</div>
                <div class="step">
                    <div class="step-num">3</div>
                    <p>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
                </div>
            </div>

            <div class="action-card">
                <h3>ğŸ… ãƒãƒƒã‚¸ç™ºè¡Œ</h3>

                <div class="form-section">
                    <h4>ğŸ‘¤ å—å–äººæƒ…å ±</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æ°å <span class="required">*</span></label>
                            <input type="text" id="recipientName" placeholder="ä¾‹: å±±ç”° å¤ªéƒ" value="å±±ç”° å¤ªéƒ" required>
                        </div>
                        <div class="form-group">
                            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">*</span></label>
                            <input type="email" id="recipientEmail" placeholder="ä¾‹: taro.yamada@example.com" value="taro.yamada@example.com" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>ğŸ… ãƒãƒƒã‚¸ãƒ»è³‡æ ¼æƒ…å ±</h4>
                    <div class="form-group">
                        <label>ãƒãƒƒã‚¸åï¼ˆé”æˆå†…å®¹ï¼‰ <span class="required">*</span></label>
                        <input type="text" id="achievementName" placeholder="ä¾‹: ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤" value="ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤" required>
                    </div>
                    <div class="form-group">
                        <label>èª¬æ˜</label>
                        <textarea id="achievementDescription" rows="3" placeholder="ãƒãƒƒã‚¸ã®èª¬æ˜..." style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®åŸºç¤çš„ãªçŸ¥è­˜ã¨ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã€å®Ÿè·µçš„ãªåˆ†æãŒã§ãã‚‹ã“ã¨ã‚’è¨¼æ˜ã—ã¾ã™ã€‚</textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>è¬›åº§å</label>
                            <input type="text" id="courseName" placeholder="ä¾‹: ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å…¥é–€" value="ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å…¥é–€">
                        </div>
                        <div class="form-group">
                            <label>è¬›åº§ã‚³ãƒ¼ãƒ‰</label>
                            <input type="text" id="courseCode" placeholder="ä¾‹: DS101" value="DS101">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ä¿®äº†æ—¥ <span class="required">*</span></label>
                            <input type="date" id="completionDate" value="2025-01-15" required>
                        </div>
                        <div class="form-group">
                            <label>æˆç¸¾</label>
                            <select id="grade">
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="å„ªç§€" selected>å„ªç§€</option>
                                <option value="å„ª">å„ª</option>
                                <option value="è‰¯">è‰¯</option>
                                <option value="å¯">å¯</option>
                                <option value="åˆæ ¼">åˆæ ¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å˜ä½æ•°</label>
                            <input type="number" id="credits" placeholder="ä¾‹: 2" value="2" min="0" max="10">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>ğŸ›ï¸ ç™ºè¡Œæ©Ÿé–¢æƒ…å ±</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ç™ºè¡Œæ©Ÿé–¢å <span class="required">*</span></label>
                            <input type="text" id="issuerName" placeholder="ä¾‹: â—‹â—‹å¤§å­¦" value="â—‹â—‹å¤§å­¦" required>
                        </div>
                        <div class="form-group">
                            <label>å­¦éƒ¨ãƒ»éƒ¨ç½²</label>
                            <input type="text" id="issuerDepartment" placeholder="ä¾‹: å·¥å­¦éƒ¨" value="å·¥å­¦éƒ¨">
                        </div>
                    </div>
                </div>

                <button class="btn-primary" onclick="issueBadge()">ğŸ… OpenBadgeã‚’ç™ºè¡Œ</button>

                <!-- Issue Result -->
                <div id="badge-result" style="display: none;">
                    <div class="qr-result" style="border-color: #667eea;">
                        <h4 style="color: #667eea;">âœ… ãƒãƒƒã‚¸ç™ºè¡Œå®Œäº†</h4>
                        <p>OpenBadges 3.0å½¢å¼ã®ãƒãƒƒã‚¸ãŒç™ºè¡Œã•ã‚Œã¾ã—ãŸ</p>

                        <!-- Badge Visual -->
                        <div class="badge-display">
                            <div class="badge-card">
                                <div class="badge-header">
                                    <div class="badge-icon">ğŸ“</div>
                                    <div class="badge-title">
                                        <h4 id="badge-display-name">ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤</h4>
                                        <p id="badge-display-issuer">â—‹â—‹å¤§å­¦</p>
                                    </div>
                                </div>
                                <div class="badge-details">
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">å—å–äºº</span>
                                        <span class="badge-detail-value" id="badge-display-recipient">å±±ç”° å¤ªéƒ</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">ä¿®äº†æ—¥</span>
                                        <span class="badge-detail-value" id="badge-display-date">2025-01-15</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">æˆç¸¾</span>
                                        <span class="badge-detail-value" id="badge-display-grade">å„ªç§€</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">å˜ä½</span>
                                        <span class="badge-detail-value" id="badge-display-credits">2å˜ä½</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs for JSON view -->
                        <div class="tab-container">
                            <div class="tab-buttons">
                                <button class="tab-btn active" onclick="showTab('simple')">ã‚·ãƒ³ãƒ—ãƒ«è¡¨ç¤º</button>
                                <button class="tab-btn" onclick="showTab('json')">JSONè¡¨ç¤º</button>
                            </div>

                            <div class="tab-content active" id="tab-simple">
                                <div class="instructions-box">
                                    <strong>ğŸ“¥ ãƒãƒƒã‚¸ã®å…±æœ‰æ–¹æ³•ï¼š</strong>
                                    <ol>
                                        <li>ã€ŒJSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã§ãƒãƒƒã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜</li>
                                        <li>ãƒ¡ãƒ¼ãƒ«ã‚„ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§å­¦ç”Ÿã«é€ä»˜</li>
                                        <li>å­¦ç”Ÿã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿ç®¡ã—ã€å¿…è¦æ™‚ã«ä¼æ¥­ã¸æå‡º</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="tab-content" id="tab-json">
                                <div class="json-display">
                                    <pre id="json-output">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://purl.imsglobal.org/spec/ob/v3p0/context-3.0.3.json"
  ],
  "id": "urn:uuid:a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "type": ["VerifiableCredential", "OpenBadgeCredential"],
  "issuer": {
    "id": "did:web:example.university.edu",
    "type": ["Profile"],
    "name": "â—‹â—‹å¤§å­¦"
  },
  "validFrom": "2025-01-15T00:00:00Z",
  "name": "ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤",
  "credentialSubject": {
    "type": ["AchievementSubject"],
    "name": "å±±ç”° å¤ªéƒ",
    "achievement": {
      "type": ["Achievement"],
      "name": "ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤",
      "description": "ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®åŸºç¤çš„ãªçŸ¥è­˜ã¨ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—...",
      "criteria": {
        "narrative": "ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å…¥é–€ã‚’ä¿®äº†ã—..."
      }
    },
    "result": [
      { "type": ["Result"], "value": "å„ªç§€" },
      { "type": ["Result"], "value": "2" }
    ]
  },
  "proof": {
    "type": "Ed25519Signature2020",
    "created": "2025-01-15T12:00:00Z",
    "verificationMethod": "did:web:example.university.edu#key-1",
    "proofPurpose": "assertionMethod",
    "proofValue": "z3FXQjecWufY46..."
  }
}</pre>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn-primary" onclick="downloadBadge()">ğŸ“¥ JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                            <button class="btn-secondary" onclick="copyBadgeJson()">ğŸ“‹ JSONã‚’ã‚³ãƒ”ãƒ¼</button>
                            <button class="btn-secondary" onclick="emailBadge()">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Issued Badges History -->
            <div class="action-card" style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3>ğŸ“œ ç™ºè¡Œå±¥æ­´</h3>
                    <button class="btn-secondary" onclick="loadIssuedBadges()" style="padding: 8px 16px;">ğŸ”„ æ›´æ–°</button>
                </div>
                <div id="issued-badges-list">
                    <p style="text-align: center; color: #666; padding: 20px;">ã€Œæ›´æ–°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç™ºè¡Œå±¥æ­´ã‚’èª­ã¿è¾¼ã¿</p>
                </div>
            </div>
        </div>

        <!-- Student View (OpenBadges Mode) -->
        <div class="role-view" id="student-view" style="display: none;">
            <div class="role-header">
                <div class="role-badge">ğŸ‘¨â€ğŸ“ å­¦ç”Ÿ <span class="ob-logo" style="margin-left: 10px;">ğŸ… OpenBadges</span></div>
                <button class="btn-back" onclick="resetRole()">â† å½¹å‰²é¸æŠã«æˆ»ã‚‹</button>
            </div>

            <div class="info-box student-info">
                <h3>ğŸ“‹ OpenBadges 3.0 ãƒãƒƒã‚¸ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ</h3>
                <p>å¤§å­¦ã‹ã‚‰ç™ºè¡Œã•ã‚ŒãŸOpenBadgesãƒãƒƒã‚¸ã‚’ç®¡ç†ã—ã€ä¼æ¥­ã«æç¤ºã—ã¾ã™ã€‚</p>
                <ul>
                    <li>âœ… ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§å–å¾—æ¸ˆã¿ãƒãƒƒã‚¸ã‚’ç¢ºèª</li>
                    <li>âœ… ã‚¯ãƒ©ã‚¦ãƒ‰ã«å®‰å…¨ã«ä¿å­˜</li>
                    <li>âœ… å¿…è¦ã«å¿œã˜ã¦ä¼æ¥­ã«æå‡º</li>
                    <li>âœ… JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§æŒã¡å‡ºã—å¯èƒ½</li>
                </ul>
            </div>

            <div class="action-card">
                <h3>ğŸ” ãƒãƒƒã‚¸ã‚’å–å¾—</h3>
                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">*</span></label>
                    <div style="display: flex; gap: 10px;">
                        <input type="email" id="walletEmail" placeholder="ä¾‹: taro.yamada@example.com" style="flex: 1;">
                        <button class="btn-primary" onclick="loadWallet()" style="white-space: nowrap;">ğŸ” ãƒãƒƒã‚¸ã‚’æ¤œç´¢</button>
                    </div>
                </div>
            </div>

            <div class="action-card" id="wallet-results" style="display: none;">
                <h3>ğŸ… å–å¾—æ¸ˆã¿ãƒãƒƒã‚¸ <span id="wallet-count" style="font-size: 0.9rem; opacity: 0.7;"></span></h3>
                <div id="wallet-badges"></div>
                <div id="wallet-empty" style="display: none; text-align: center; padding: 40px; color: #666;">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“­</div>
                    <p>ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç™ºè¡Œã•ã‚ŒãŸãƒãƒƒã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>

            <div class="highlight-box" style="margin-top: 20px;">
                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼šLinkedInã§å…±æœ‰</strong>
                <p>OpenBadges 3.0å½¢å¼ã®ãƒãƒƒã‚¸ã¯LinkedInã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«è¿½åŠ ã§ãã¾ã™ã€‚ã€Œè³‡æ ¼ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã€å–å¾—ã—ãŸè³‡æ ¼ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã§ãã¾ã™ã€‚</p>
            </div>
        </div>

        <!-- Company View (OpenBadges Mode) -->
        <div class="role-view" id="company-view" style="display: none;">
            <div class="role-header">
                <div class="role-badge">ğŸ¢ ä¼æ¥­æ¡ç”¨æ‹…å½“è€… <span class="ob-logo" style="margin-left: 10px;">ğŸ… OpenBadges</span></div>
                <button class="btn-back" onclick="resetRole()">â† å½¹å‰²é¸æŠã«æˆ»ã‚‹</button>
            </div>

            <div class="info-box company-info">
                <h3>ğŸ“‹ OpenBadges 3.0 æ¤œè¨¼</h3>
                <p>å¿œå‹Ÿè€…ã‹ã‚‰æå‡ºã•ã‚ŒãŸãƒãƒƒã‚¸ã®çœŸæ­£æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚</p>
                <ul>
                    <li>âœ… JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</li>
                    <li>âœ… ç™ºè¡Œè€…ã®ç½²åã‚’è‡ªå‹•æ¤œè¨¼</li>
                    <li>âœ… æ”¹ã–ã‚“ãŒãªã„ã“ã¨ã‚’ç¢ºèª</li>
                    <li>âœ… ç™ºè¡Œæ—¥ãƒ»æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯</li>
                </ul>
            </div>

            <div class="flow-steps-horizontal">
                <div class="step active">
                    <div class="step-num">1</div>
                    <p>ãƒãƒƒã‚¸å—å–</p>
                </div>
                <div class="arrow">â†’</div>
                <div class="step">
                    <div class="step-num">2</div>
                    <p>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                </div>
                <div class="arrow">â†’</div>
                <div class="step">
                    <div class="step-num">3</div>
                    <p>ç½²åæ¤œè¨¼</p>
                </div>
                <div class="arrow">â†’</div>
                <div class="step">
                    <div class="step-num">4</div>
                    <p>çµæœç¢ºèª</p>
                </div>
            </div>

            <div class="action-card">
                <h3>âœ… ãƒãƒƒã‚¸æ¤œè¨¼</h3>

                <div class="file-upload-area" id="upload-area" onclick="document.getElementById('badge-file').click()">
                    <div class="upload-icon">ğŸ“¤</div>
                    <p class="upload-text">
                        <strong>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒƒã‚¸JSONã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong><br>
                        ã¾ãŸã¯ã€ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
                    </p>
                    <input type="file" id="badge-file" accept=".json" style="display: none;" onchange="handleFileUpload(event)">
                </div>

                <div style="text-align: center; margin: 20px 0; color: #666;">ã¾ãŸã¯</div>

                <div class="form-group">
                    <label>ãƒãƒƒã‚¸JSONã‚’ç›´æ¥ãƒšãƒ¼ã‚¹ãƒˆ</label>
                    <textarea id="badge-json-input" rows="6" placeholder='{"@context": [...], "type": ["VerifiableCredential", "OpenBadgeCredential"], ...}' style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace; font-size: 0.9rem;"></textarea>
                </div>

                <button class="btn-primary" onclick="verifyBadge()">ğŸ” ãƒãƒƒã‚¸ã‚’æ¤œè¨¼</button>

                <!-- Verification Result (Success) -->
                <div id="verify-result-success" style="display: none;">
                    <div class="verification-result success">
                        <div class="verification-icon">âœ…</div>
                        <div class="verification-title">æ¤œè¨¼æˆåŠŸï¼šã“ã®ãƒãƒƒã‚¸ã¯æœ‰åŠ¹ã§ã™</div>

                        <div class="badge-display" style="background: #1a1a2e;">
                            <div class="badge-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                                <div class="badge-header">
                                    <div class="badge-icon">ğŸ“</div>
                                    <div class="badge-title">
                                        <h4>ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹åŸºç¤</h4>
                                        <p>â—‹â—‹å¤§å­¦</p>
                                    </div>
                                </div>
                                <div class="badge-details">
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">å—å–äºº</span>
                                        <span class="badge-detail-value">å±±ç”° å¤ªéƒ</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">ç™ºè¡Œæ—¥</span>
                                        <span class="badge-detail-value">2025-01-15</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">ç½²å</span>
                                        <span class="badge-detail-value" style="color: #90EE90;">âœ“ æœ‰åŠ¹</span>
                                    </div>
                                    <div class="badge-detail-item">
                                        <span class="badge-detail-label">ç™ºè¡Œè€…DID</span>
                                        <span class="badge-detail-value" style="font-size: 0.8rem;">did:web:example.university.edu</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="instructions-box" style="margin-top: 20px;">
                            <strong>âœ… æ¤œè¨¼çµæœã®è©³ç´°ï¼š</strong>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>âœ“ ç½²åæ¤œè¨¼: æˆåŠŸï¼ˆEd25519Signature2020ï¼‰</li>
                                <li>âœ“ ç™ºè¡Œè€…ç¢ºèª: â—‹â—‹å¤§å­¦ï¼ˆdid:web:example.university.eduï¼‰</li>
                                <li>âœ“ æœ‰åŠ¹æœŸé™: æœ‰åŠ¹ï¼ˆ2025-01-15ç™ºè¡Œï¼‰</li>
                                <li>âœ“ æ”¹ã–ã‚“ãƒã‚§ãƒƒã‚¯: å•é¡Œãªã—</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Verification Result (Failed) - Hidden by default -->
                <div id="verify-result-failed" style="display: none;">
                    <div class="verification-result failed">
                        <div class="verification-icon">âŒ</div>
                        <div class="verification-title">æ¤œè¨¼å¤±æ•—ï¼šã“ã®ãƒãƒƒã‚¸ã¯ç„¡åŠ¹ã§ã™</div>
                        <div class="instructions-box" style="background: #fff; margin-top: 20px;">
                            <strong>âš ï¸ æ¤œå‡ºã•ã‚ŒãŸå•é¡Œï¼š</strong>
                            <ul style="margin-left: 20px; margin-top: 10px; color: #721c24;">
                                <li>âœ— ç½²åãŒç„¡åŠ¹ã¾ãŸã¯æ”¹ã–ã‚“ã•ã‚Œã¦ã„ã¾ã™</li>
                                <li>âœ— ç™ºè¡Œè€…ã®å…¬é–‹éµã‚’ç¢ºèªã§ãã¾ã›ã‚“</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="system-status">
            <h3>ğŸ–¥ï¸ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">Badge Service:</span>
                    <span class="status-indicator online">ç¢ºèªä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ãƒ¢ãƒ¼ãƒ‰:</span>
                    <span class="status-indicator" style="background: #e3f2fd; color: #1565c0;">OpenBadges 3.0</span>
                </div>
            </div>
        </div>

        <footer>
            <p>Â© 2025 ãƒã‚¤ã‚¯ãƒ­ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ç™ºè¡Œãƒ»æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ  (OpenBadges 3.0 + W3C Verifiable Credentials)</p>
            <p style="font-size: 0.85rem; opacity: 0.8;">OpenBadges 3.0æº–æ‹ ã®ãƒãƒƒã‚¸ç™ºè¡Œãƒ»æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </p>
        </footer>
    </div>

    <script>
        // Store issued badge for download/copy
        let issuedBadge = null;

        // Role selection
        function selectRole(role) {
            document.getElementById('role-selector').style.display = 'none';
            document.getElementById(role + '-view').style.display = 'block';
        }

        function resetRole() {
            document.querySelectorAll('.role-view').forEach(v => v.style.display = 'none');
            document.getElementById('role-selector').style.display = 'block';
        }

        // Mode switching
        function switchMode(mode) {
            if (mode === 'msvc') {
                // Redirect to original page
                window.location.href = 'index.html';
            }
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Badge issuance - calls actual API
        async function issueBadge() {
            const issueBtn = document.querySelector('.action-card .btn-primary');
            const originalText = issueBtn.textContent;
            issueBtn.textContent = 'ç™ºè¡Œä¸­...';
            issueBtn.disabled = true;

            try {
                const response = await fetch(`${BADGE_SERVICE_URL}/api/badge/issue`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        recipientName: document.getElementById('recipientName').value,
                        recipientEmail: document.getElementById('recipientEmail').value,
                        achievementName: document.getElementById('achievementName').value,
                        achievementDescription: document.getElementById('achievementDescription').value,
                        issuerName: document.getElementById('issuerName').value,
                        courseName: document.getElementById('courseName').value,
                        courseCode: document.getElementById('courseCode').value,
                        completionDate: document.getElementById('completionDate').value,
                        grade: document.getElementById('grade').value,
                        credits: document.getElementById('credits').value ? parseInt(document.getElementById('credits').value) : null
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                issuedBadge = data.credential;

                // Update badge display with actual data
                document.getElementById('badge-display-name').textContent = issuedBadge.name || issuedBadge.credentialSubject?.achievement?.name;
                document.getElementById('badge-display-issuer').textContent = issuedBadge.issuer?.name || issuedBadge.issuer?.id;
                document.getElementById('badge-display-recipient').textContent = issuedBadge.credentialSubject?.name;
                document.getElementById('badge-display-date').textContent = issuedBadge.credentialSubject?.achievedDate || issuedBadge.validFrom?.split('T')[0];

                // Extract grade and credits from results
                const results = issuedBadge.credentialSubject?.result || [];
                const gradeResult = results.find(r => r.resultDescription?.resultType === 'GradeLevel');
                const creditsResult = results.find(r => r.resultDescription?.resultType === 'CreditHours');
                document.getElementById('badge-display-grade').textContent = gradeResult?.value || '-';
                document.getElementById('badge-display-credits').textContent = (creditsResult?.value || '0') + 'å˜ä½';

                // Update JSON display
                document.getElementById('json-output').textContent = JSON.stringify(issuedBadge, null, 2);

                // Show result
                document.getElementById('badge-result').style.display = 'block';
                document.getElementById('badge-result').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Badge issuance error:', error);
                alert('ãƒãƒƒã‚¸ã®ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                issueBtn.textContent = originalText;
                issueBtn.disabled = false;
            }
        }

        // Download badge
        function downloadBadge() {
            if (!issuedBadge) {
                alert('å…ˆã«ãƒãƒƒã‚¸ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„');
                return;
            }

            const blob = new Blob([JSON.stringify(issuedBadge, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `badge-${issuedBadge.credentialSubject?.name?.replace(/\s/g, '-') || 'credential'}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Copy badge JSON
        function copyBadgeJson() {
            if (!issuedBadge) {
                alert('å…ˆã«ãƒãƒƒã‚¸ã‚’ç™ºè¡Œã—ã¦ãã ã•ã„');
                return;
            }
            const json = JSON.stringify(issuedBadge, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                alert('JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        }

        // Email badge
        function emailBadge() {
            const subject = encodeURIComponent('OpenBadge: ' + document.getElementById('achievementName').value);
            const body = encodeURIComponent('ä»¥ä¸‹ã®OpenBadgeã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚æ·»ä»˜ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
            window.location.href = `mailto:${document.getElementById('recipientEmail').value}?subject=${subject}&body=${body}`;
        }

        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('badge-json-input').value = e.target.result;
                };
                reader.readAsText(file);
            }
        }

        // Drag and drop
        const uploadArea = document.getElementById('upload-area');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.json')) {
                    const reader = new FileReader();
                    reader.onload = function(evt) {
                        document.getElementById('badge-json-input').value = evt.target.result;
                    };
                    reader.readAsText(file);
                }
            });
        }

        // Verify badge - calls actual API
        async function verifyBadge() {
            const jsonInput = document.getElementById('badge-json-input').value;

            if (!jsonInput.trim()) {
                alert('ãƒãƒƒã‚¸JSONã‚’å…¥åŠ›ã¾ãŸã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„');
                return;
            }

            let credential;
            try {
                credential = JSON.parse(jsonInput);
            } catch (e) {
                alert('ç„¡åŠ¹ãªJSONå½¢å¼ã§ã™');
                document.getElementById('verify-result-success').style.display = 'none';
                document.getElementById('verify-result-failed').style.display = 'block';
                document.getElementById('verify-result-failed').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const verifyBtn = document.querySelector('#company-view .btn-primary');
            const originalText = verifyBtn.textContent;
            verifyBtn.textContent = 'æ¤œè¨¼ä¸­...';
            verifyBtn.disabled = true;

            try {
                const response = await fetch(`${BADGE_SERVICE_URL}/api/badge/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ credential })
                });

                const result = await response.json();

                if (result.verified) {
                    // Update success display with actual credential info
                    const successCard = document.querySelector('#verify-result-success .badge-card');
                    if (successCard) {
                        const info = result.credentialInfo || {};
                        successCard.querySelector('.badge-title h4').textContent = info.achievement?.name || credential.name || 'Unknown';
                        successCard.querySelector('.badge-title p').textContent = info.issuer?.name || 'Unknown Issuer';

                        const details = successCard.querySelectorAll('.badge-detail-value');
                        if (details[0]) details[0].textContent = info.subject?.name || 'Unknown';
                        if (details[1]) details[1].textContent = info.validFrom?.split('T')[0] || 'Unknown';
                        if (details[3]) details[3].textContent = info.issuer?.id || 'Unknown';
                    }

                    document.getElementById('verify-result-success').style.display = 'block';
                    document.getElementById('verify-result-failed').style.display = 'none';
                    document.getElementById('verify-result-success').scrollIntoView({ behavior: 'smooth' });
                } else {
                    // Update failure message
                    const failedBox = document.querySelector('#verify-result-failed .instructions-box ul');
                    if (failedBox) {
                        failedBox.innerHTML = `<li>âœ— ${result.error || 'ç½²åæ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ'}</li>`;
                    }

                    document.getElementById('verify-result-success').style.display = 'none';
                    document.getElementById('verify-result-failed').style.display = 'block';
                    document.getElementById('verify-result-failed').scrollIntoView({ behavior: 'smooth' });
                }

            } catch (error) {
                console.error('Verification error:', error);
                alert('æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                document.getElementById('verify-result-success').style.display = 'none';
                document.getElementById('verify-result-failed').style.display = 'block';
            } finally {
                verifyBtn.textContent = originalText;
                verifyBtn.disabled = false;
            }
        }

        // Check Badge Service status on load
        async function checkBadgeServiceStatus() {
            const statusIndicator = document.querySelector('.status-indicator.online');
            try {
                const response = await fetch(`${BADGE_SERVICE_URL}/health`);
                const data = await response.json();
                if (response.ok) {
                    if (statusIndicator) {
                        const dbStatus = data.database?.dbConnected ? 'DBæ¥ç¶šæ¸ˆ' : 'DBãªã—';
                        statusIndicator.textContent = `ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ (${dbStatus})`;
                        statusIndicator.classList.add('online');
                    }
                } else {
                    throw new Error('Service unavailable');
                }
            } catch (e) {
                if (statusIndicator) {
                    statusIndicator.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
                    statusIndicator.classList.remove('online');
                    statusIndicator.style.background = '#f8d7da';
                    statusIndicator.style.color = '#721c24';
                }
            }
        }

        // Load student wallet by email
        async function loadWallet() {
            const email = document.getElementById('walletEmail').value.trim();
            if (!email) {
                alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const resultsDiv = document.getElementById('wallet-results');
            const badgesDiv = document.getElementById('wallet-badges');
            const emptyDiv = document.getElementById('wallet-empty');
            const countSpan = document.getElementById('wallet-count');

            resultsDiv.style.display = 'block';
            badgesDiv.innerHTML = '<p style="text-align: center; padding: 20px;">èª­ã¿è¾¼ã¿ä¸­...</p>';
            emptyDiv.style.display = 'none';

            try {
                const response = await fetch(`${BADGE_SERVICE_URL}/api/badge/wallet/${encodeURIComponent(email)}`);
                const data = await response.json();

                if (data.badges && data.badges.length > 0) {
                    countSpan.textContent = `(${data.count}ä»¶)`;
                    badgesDiv.innerHTML = data.badges.map(badge => `
                        <div class="badge-display" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                                <div class="badge-icon" style="background: white; flex-shrink: 0;">ğŸ“</div>
                                <div style="flex: 1; min-width: 200px;">
                                    <h4 style="margin: 0 0 5px 0;">${badge.achievement_name}</h4>
                                    <p style="margin: 0; opacity: 0.9;">${badge.issuer_name} | ${new Date(badge.issued_at).toLocaleDateString('ja-JP')}</p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-secondary" style="background: white; border: none;" onclick='showBadgeDetail(${JSON.stringify(badge.credential).replace(/'/g, "&#39;")})'>ğŸ‘ï¸ è©³ç´°</button>
                                    <button class="btn-secondary" style="background: white; border: none;" onclick='downloadWalletBadge(${JSON.stringify(badge.credential).replace(/'/g, "&#39;")}, "${badge.recipient_name}")'>ğŸ“¥ ä¿å­˜</button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    countSpan.textContent = '(0ä»¶)';
                    badgesDiv.innerHTML = '';
                    emptyDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Wallet load error:', error);
                badgesDiv.innerHTML = `<p style="color: #dc3545; text-align: center; padding: 20px;">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // Show badge detail in modal/alert
        function showBadgeDetail(credential) {
            alert(JSON.stringify(credential, null, 2));
        }

        // Download badge from wallet
        function downloadWalletBadge(credential, recipientName) {
            const blob = new Blob([JSON.stringify(credential, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `badge-${recipientName.replace(/\s/g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load issued badges (for university view)
        async function loadIssuedBadges() {
            const listDiv = document.getElementById('issued-badges-list');
            listDiv.innerHTML = '<p style="text-align: center; padding: 20px;">èª­ã¿è¾¼ã¿ä¸­...</p>';

            try {
                const response = await fetch(`${BADGE_SERVICE_URL}/api/badge/issued`);
                const data = await response.json();

                if (data.badges && data.badges.length > 0) {
                    listDiv.innerHTML = `
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead>
                                <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                                    <th style="padding: 12px; text-align: left;">å—å–äºº</th>
                                    <th style="padding: 12px; text-align: left;">ãƒãƒƒã‚¸å</th>
                                    <th style="padding: 12px; text-align: left;">ç™ºè¡Œæ©Ÿé–¢</th>
                                    <th style="padding: 12px; text-align: left;">ç™ºè¡Œæ—¥</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.badges.map(badge => `
                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                        <td style="padding: 12px;">${badge.recipient_name}</td>
                                        <td style="padding: 12px;">${badge.achievement_name}</td>
                                        <td style="padding: 12px;">${badge.issuer_name}</td>
                                        <td style="padding: 12px;">${new Date(badge.issued_at).toLocaleDateString('ja-JP')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <p style="text-align: right; color: #666; font-size: 0.85rem; margin-top: 10px;">åˆè¨ˆ ${data.count} ä»¶</p>
                    `;
                } else {
                    listDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ç™ºè¡Œå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                }
            } catch (error) {
                console.error('Load issued badges error:', error);
                listDiv.innerHTML = `<p style="color: #dc3545; text-align: center; padding: 20px;">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', checkBadgeServiceStatus);
    </script>
</body>
</html>
